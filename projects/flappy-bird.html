<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Flappy Bird - Martiplier's Projects</title>
    <style>
        body { margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; background: #111; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { border: 4px solid #000; background-color: #70c5ce; box-shadow: 0 0 20px rgba(0,0,0,0.5); cursor: pointer; }
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 400;
canvas.height = 600;

const imgBg = new Image(); imgBg.src = 'https://martipliersprojects.github.io/images/fb_background.png';
const imgBird = new Image(); imgBird.src = 'https://martipliersprojects.github.io/images/fb_bird.png';
const imgBase = new Image(); imgBase.src = 'https://martipliersprojects.github.io/images/fb_base.png';
const imgPipe = new Image(); imgPipe.src = 'https://martipliersprojects.github.io/images/fb_tube.png';
const imgGameOver = new Image(); imgGameOver.src = 'https://martipliersprojects.github.io/images/fb_gameover.png';

let gameState = 'MENU'; 
let bird = { x: 70, y: 250, w: 45, h: 32, velocity: 0, gravity: 0.22, jump: -5, rotation: 0 };
let pipes = [];
let score = 0;
let baseScroll = 0;
const pipeGap = 150;
const pipeWidth = 65;

function reset() {
    bird.y = 250; bird.velocity = 0; bird.rotation = 0;
    pipes = []; score = 0;
    gameState = 'PLAYING';
}

function handleInput() {
    if (gameState === 'MENU' || gameState === 'GAMEOVER') reset();
    else if (gameState === 'PLAYING') bird.velocity = bird.jump;
}

document.addEventListener('keydown', (e) => { if(e.code === 'Space') handleInput(); });
canvas.addEventListener('mousedown', handleInput);

function createPipe() {
    let minH = 60;
    let maxH = canvas.height - pipeGap - minH - 112;
    let topH = Math.floor(Math.random() * (maxH - minH + 1)) + minH;
    pipes.push({ x: canvas.width, top: topH, passed: false });
}

function update() {
    baseScroll = (baseScroll + 2.5) % canvas.width;
    if (gameState !== 'PLAYING') return;

    bird.velocity += bird.gravity;
    bird.y += bird.velocity;
    bird.rotation = Math.min(Math.PI / 4, Math.max(-Math.PI / 7, bird.velocity * 0.1));

    if (pipes.length === 0 || pipes[pipes.length - 1].x < canvas.width - 200) createPipe();

    for (let i = pipes.length - 1; i >= 0; i--) {
        let p = pipes[i];
        p.x -= 2.5;

        if (bird.x + 5 < p.x + pipeWidth && bird.x + bird.w - 5 > p.x) {
            if (bird.y + 5 < p.top || bird.y + bird.h - 5 > p.top + pipeGap) gameState = 'GAMEOVER';
        }

        if (!p.passed && bird.x > p.x + pipeWidth) {
            score++;
            p.passed = true;
        }
        if (p.x + pipeWidth < 0) pipes.splice(i, 1);
    }

    if (bird.y + bird.h > canvas.height - 112 || bird.y < 0) gameState = 'GAMEOVER';
}

function draw() {
    ctx.drawImage(imgBg, 0, 0, canvas.width, canvas.height);

    pipes.forEach(p => {
        ctx.save();
        ctx.translate(p.x + pipeWidth, p.top);
        ctx.rotate(Math.PI);
        ctx.drawImage(imgPipe, 0, 0, pipeWidth, 450);
        ctx.restore();
        ctx.drawImage(imgPipe, p.x, p.top + pipeGap, pipeWidth, 450);
    });

    ctx.drawImage(imgBase, -baseScroll, canvas.height - 112, canvas.width, 112);
    ctx.drawImage(imgBase, canvas.width - baseScroll, canvas.height - 112, canvas.width, 112);

    if (gameState === 'MENU') {
        ctx.fillStyle = "rgba(0,0,0,0.5)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.font = "bold 28px Arial";
        ctx.fillText("Flappy Bird", canvas.width / 2, 220);
        ctx.font = "18px Arial";
        ctx.fillText("Martiplier's Projects", canvas.width / 2, 250);
        ctx.font = "bold 20px Arial";
        ctx.fillText("CLICCA PER INIZIARE", canvas.width / 2, 340);
    } else {
        ctx.save();
        ctx.translate(bird.x + bird.w / 2, bird.y + bird.h / 2);
        ctx.rotate(bird.rotation);
        ctx.drawImage(imgBird, -bird.w / 2, -bird.h / 2, bird.w, bird.h);
        ctx.restore();

        ctx.fillStyle = "white";
        ctx.strokeStyle = "black";
        ctx.lineWidth = 3;
        ctx.font = "bold 50px Arial";
        ctx.textAlign = "center";
        ctx.fillText(score, canvas.width / 2, 80);
        ctx.strokeText(score, canvas.width / 2, 80);
    }

    if (gameState === 'GAMEOVER') {
        ctx.drawImage(imgGameOver, canvas.width / 2 - 96, canvas.height / 2 - 60);
        ctx.fillStyle = "white";
        ctx.font = "bold 20px Arial";
        ctx.fillText("CLICCA PER RICOMINCIARE", canvas.width / 2, canvas.height / 2 + 40);
    }

    update();
    requestAnimationFrame(draw);
}

imgBg.onload = () => draw();
</script>
</body>
</html>
