<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Flappy Bird - Martiplier's Projects</title>
    <style>
        body { margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; background: #222; overflow: hidden; font-family: 'Arial', sans-serif; }
        canvas { border: 2px solid #000; background-color: #70c5ce; cursor: pointer; }
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 320;
canvas.height = 480;

const imgBg = new Image(); imgBg.src = 'https://martipliersprojects.github.io/images/fb_background.png';
const imgBird = new Image(); imgBird.src = 'https://martipliersprojects.github.io/images/fb_bird.png';
const imgBase = new Image(); imgBase.src = 'https://martipliersprojects.github.io/images/fb_base.png';
const imgPipe = new Image(); imgPipe.src = 'https://martipliersprojects.github.io/images/fb_tube.png';
const imgGameOver = new Image(); imgGameOver.src = 'https://martipliersprojects.github.io/images/fb_gameover.png';

let gameState = 'MENU'; 
let bird = { x: 50, y: 200, w: 34, h: 24, velocity: 0, gravity: 0.25, jump: -4.5 };
let pipes = [];
let score = 0;
let baseScroll = 0;
const pipeGap = 120;
const pipeWidth = 52;

function reset() {
    bird.y = 200; bird.velocity = 0;
    pipes = []; score = 0;
    gameState = 'PLAYING';
}

function handleInput() {
    if (gameState === 'MENU' || gameState === 'GAMEOVER') reset();
    else if (gameState === 'PLAYING') bird.velocity = bird.jump;
}

document.addEventListener('keydown', (e) => { if(e.code === 'Space') handleInput(); });
canvas.addEventListener('mousedown', handleInput);

function createPipe() {
    let minH = 50;
    let maxH = canvas.height - pipeGap - minH - 112;
    let topH = Math.floor(Math.random() * (maxH - minH + 1)) + minH;
    pipes.push({ x: canvas.width, top: topH, passed: false });
}

function update() {
    baseScroll = (baseScroll + 2) % canvas.width;
    if (gameState !== 'PLAYING') return;

    bird.velocity += bird.gravity;
    bird.y += bird.velocity;

    if (pipes.length === 0 || pipes[pipes.length - 1].x < canvas.width - 160) createPipe();

    for (let i = pipes.length - 1; i >= 0; i--) {
        let p = pipes[i];
        p.x -= 2;

        if (bird.x + bird.w > p.x && bird.x < p.x + pipeWidth) {
            if (bird.y < p.top || bird.y + bird.h > p.top + pipeGap) gameState = 'GAMEOVER';
        }

        if (!p.passed && bird.x > p.x + pipeWidth) {
            score++;
            p.passed = true;
        }
        if (p.x + pipeWidth < 0) pipes.splice(i, 1);
    }

    if (bird.y + bird.h > canvas.height - 112 || bird.y < 0) gameState = 'GAMEOVER';
}

function draw() {
    ctx.drawImage(imgBg, 0, 0, canvas.width, canvas.height);

    pipes.forEach(p => {
        ctx.save();
        ctx.translate(p.x + pipeWidth, p.top);
        ctx.rotate(Math.PI);
        ctx.drawImage(imgPipe, 0, 0, pipeWidth, 400);
        ctx.restore();
        ctx.drawImage(imgPipe, p.x, p.top + pipeGap, pipeWidth, 400);
    });

    ctx.drawImage(imgBase, -baseScroll, canvas.height - 112, canvas.width, 112);
    ctx.drawImage(imgBase, canvas.width - baseScroll, canvas.height - 112, canvas.width, 112);

    if (gameState === 'MENU') {
        ctx.fillStyle = "rgba(0,0,0,0.4)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.font = "bold 20px Arial";
        ctx.fillText("Flappy Bird", canvas.width / 2, 180);
        ctx.font = "14px Arial";
        ctx.fillText("Martiplier's Projects", canvas.width / 2, 205);
        ctx.font = "bold 18px Arial";
        ctx.fillText("CLICK TO START", canvas.width / 2, 300);
    } else {
        ctx.drawImage(imgBird, bird.x, bird.y, bird.w, bird.h);
        ctx.fillStyle = "white";
        ctx.strokeStyle = "black";
        ctx.lineWidth = 2;
        ctx.font = "bold 40px Arial";
        ctx.textAlign = "center";
        ctx.fillText(score, canvas.width / 2, 60);
        ctx.strokeText(score, canvas.width / 2, 60);
    }

    if (gameState === 'GAMEOVER') {
        ctx.drawImage(imgGameOver, canvas.width / 2 - 96, canvas.height / 2 - 50);
        ctx.fillStyle = "white";
        ctx.font = "bold 16px Arial";
        ctx.fillText("CLICK TO RESTART", canvas.width / 2, canvas.height / 2 + 30);
    }

    update();
    requestAnimationFrame(draw);
}

imgBg.onload = () => draw();
</script>
</body>
</html>
